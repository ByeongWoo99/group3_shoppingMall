<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" th:href="@{/css/Bars.css}">
<link rel="stylesheet" th:href="@{/css/Login.css}">
<link th:href="@{/css/homecss/homeStyles.css}" rel="stylesheet" />
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>로그인</title>
</head>

<style>

</style>
<div th:replace="Bars/nav_bar :: nav"></div>
<body>
<!-- 네비게이션 바 포함 -->

<div class="login-container" style="width: 600px;">
    <div class="container px-4 px-lg-5 mt-5" style="display: flex; justify-content: center; align-items: center; height: 50vh;">
        <div class="d-flex flex-column align-items-center gap-3" style="width: 600px;">
            <!-- 아이디 입력 + 중복 확인 버튼 -->
            <div class="d-flex gap-2" style="width: 100%; max-width: 400px;">
                <input class="form-control flex-grow-1" type="text" placeholder="아이디" name="customerId"/>
                <button class="btn btn-outline-primary" onclick="duplicateCheck()">중복 확인</button>
            </div>

            <!-- 중복 확인 메시지 삽입 위치 -->
            <div id="idCheckMessage" style="margin-top: 5px;"></div>

            <input class="form-control" type="password" placeholder="비밀번호" style="width: 100%; max-width: 400px;" />
            <input class="form-control" type="password" placeholder="비밀번호 확인" style="width: 100%; max-width: 400px;" />
            <div class="d-flex gap-2" style="width: 100%; max-width: 400px;">
                <input class="form-control" type="text" placeholder="이메일" name = "email" style="width: 100%; max-width: 400px;" />
                <button class="btn btn-outline-primary" onclick="emailCheck()">이메일 인증</button>
            </div>
            <div class="d-flex gap-2" style="width: 100%; max-width: 400px;">
                <input class="form-control" type="text" placeholder="주소" style="width: 100%; max-width: 400px;" />
                <button class="btn btn-outline-primary">주소 검색</button>
            </div>
            <input class="form-control" type="text" placeholder="전화번호" style="width: 100%; max-width: 400px;" />
            <input class="form-control" type="text" placeholder="추천인" style="width: 100%; max-width: 400px;" />
            <button class="btn btn-dark" style="width: 100%; max-width: 400px;">가입 완료</button>
        </div>
    </div>
</div>

<footer>
    <div th:replace="Bars/footer :: #footer"></div>
</footer>

<script type="text/javascript">
    const duplicateCheck = () => {
        const customerId = document.querySelector('input[name="customerId"]').value;
        axios({
            method: "post",
            url: "/user/registerCheck",
            headers: {
                'Content-Type': 'application/json'
            },
            data: {
                customerId: customerId,
            }
        }).then(res => {
            console.log("res", res);

            // 아이디가 사용 가능하면
            let message = document.querySelector("#idCheckMessage");
            if (!message) {
                message = document.createElement("div");
                message.id = "idCheckMessage";
                document.querySelector('input[name="customerId"]').parentNode.appendChild(message);
            }

            // "불일치"는 사용 가능하다는 의미
            if (res.data === "불일치") {
                message.textContent = "사용 가능한 아이디입니다";
                message.style.color = "green"; // 초록색
            } else {
                message.textContent = "아이디가 중복됩니다. 확인 해주세요";
                message.style.color = "red"; // 빨간색
            }
            message.style.marginTop = "5px";
        }).catch(err => {
            console.log("err", err);
        });
    }

    const emailCheck = () => {
        const email = document.querySelector('input[name="email"]').value;
        axios({
            method: "post",
            url: "/user/emailSend",
            headers: {
                'Content-Type': 'application/json'
            },
            data: {
                email: email,
            }
        }).then(res => {
            console.log("res", res);
        }).catch(err => {
            console.log("err", err);
        });
    }
</script>

</body>
</html>
