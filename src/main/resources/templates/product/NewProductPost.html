<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="">
<head>
    <meta charset="UTF-8">
    <title>상품 상세 정보 수정</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<h1>관리자 - 상품 추가 등록</h1>
<section>
    <div>
        <div>
            <form id="newProductForm">
                <!-- 메인 사진 수정 -->
                <div>
                    <h3>(1) 메인 사진</h3>
                    <!-- 버튼 클릭 시 파일 선택 창 열리기 -->
                    <button type="button" onclick="openNewFileInput()">사진 선택</button>

                    <!-- 파일 선택 input 태그 (숨겨놓음) -->
                    <input type="file" id="newImg" style="display: none;" onchange="storeFileInLocalStorage(event)">

                    <!-- 선택한 이미지 미리보기 -->
                    <div>
                        <h3>선택된 이미지 미리보기:</h3>
                        <img id="newImgPreview" src="" alt="미리보기 이미지" style="max-width: 300px;">
                    </div>
                </div>
                <br>
                <!-- 상품 이름 수정 -->
                <div>
                    <h3>(2) 등록된 상품 이름</h3>
                    <input type="text" name="productName">
                </div>
                <br>
                <!-- 상품 가격 수정 -->
                <div>
                    <h3>(3) 상품 가격</h3>
                    <input type="text" name="productPrice">
                </div>
                <br>
                <!-- 상품 상세 설명 수정 -->
                <div>
                    <h3>(4) 상품 상세 설명</h3>
                    <textarea name="productDescription"></textarea>
                </div>
                <br>
                <!-- 카테고리 수정 -->
                <div>
                    <h3>(5) 카테고리</h3>
                    <select name="productCategoryId">
                        <option>분류</option>
                        <th:block th:each="category : ${productCategory}">
                            <option th:text="${category.getName()}" th:value="${category.getCategoryId()}"></option>
                        </th:block>
                    </select>
                </div>
                <br>
                <!-- 시즌 수정 -->
                <div>
                    <h3>(6) 시즌</h3>
                    <input type="text" name="productSessionId">
                </div>
                <br>
                <!-- 비고 수정 -->
                <div>
                    <h3>(7) 비고</h3>
                    <textarea name="productNotes"></textarea >
                </div>
                <br>
                <!-- 성별 수정 -->
                <div>
                    <h3>(8) 성별</h3>
                    <input type="text" name="productGender">
                </div>
                <br>
                <!-- 핏 정보 수정 -->
                <div>
                    <h3>(9) 핏</h3>
                    <input type="text" name="productFit">
                </div>
                <br>
                <!-- 촉감 정보 수정 -->
                <div>
                    <h3>(10) 촉감</h3>
                    <input type="text" name="productTexture">
                </div>
                <br>
                <!-- 두께 정보 수정 -->
                <div>
                    <h3>(11) 두께</h3>
                    <input type="text" name="productThickness">
                </div>
                <br>
                <!-- 제조사 수정 -->
                <div>
                    <h3>(12) 제조사</h3>
                    <input type="text" name="productManufacturer">
                </div>
                <br>
                <!-- 원산지 수정 -->
                <div>
                    <h3>(13) 원산지</h3>
                    <input type="text" name="productOrigin">
                </div>
                <br>
                <!-- 품질 보증 기준 수정 -->
                <div>
                    <h3>(14) 품질 보증 기준</h3>
                    <input type="text" name="productQualityAssuranceStandard">
                </div>
                <br>
                <!-- 색상 수정 -->
                <div>
                    <h3>(15) 색상</h3>
                    <div id="colorContainer">
                        <input type="text" name="colors">
                    </div>
                    <button type="button" onclick="return addColorInput('colors')">추가</button>
                </div>
                <br>
                <!-- 사이즈 수정 -->
                <div>
                    <h3>(16) 사이즈</h3>
                    <div id="sizeContainer">
                        <input type="text" name="sizes">
                    </div>
                    <button type="button" onclick="return addSizeInput('sizes')">추가</button>
                </div>
                <br>
                <button type="submit">등록 완료</button>
            </form>
        </div>
    </div>
</section>

<script>
    function storeFileInLocalStorage(event) {

        const file = event.target.files[0];  // 선택된 파일
        const reader = new FileReader();

        reader.onload = function() {
            // 파일을 Base64로 변환한 후 localStorage에 저장
            const base64File = reader.result;
            localStorage.setItem('uploadedFile', base64File);  // 'uploadedFile' 키로 저장
            console.log("파일이 로컬 저장소에 저장되었습니다.");
        };

        if (file) {
            reader.readAsDataURL(file);  // 파일을 Base64로 읽기
        }
        loadFileFromLocalStorage()
    }

    function loadFileFromLocalStorage() {

        const storedFile = localStorage.getItem('uploadedFile');
        if (storedFile) {
            const preview = document.getElementById('newImgPreview');
            preview.src = storedFile;  // Base64로 저장된 파일을 미리보기 이미지로 표시
            console.log("저장된 파일을 로드했습니다.");
        } else {
            console.log("저장된 파일이 없습니다.");
        }
    }


    // 파일 선택 input 클릭 함수
    function openNewFileInput() {
        document.getElementById('newImg').click();  // 파일 선택 input 클릭
    }


    document.getElementById('newProductForm').addEventListener('submit', function(event) {
        event.preventDefault(); // 기본 폼 제출 방지

        let confirmUpdate = confirm("상품을 추가하시겠습니까?");
        if (!confirmUpdate) return;

        // const formData = new FormData();
        const formData = new FormData(document.getElementById("newProductForm"));
        // DTO 데이터 수집
        // const productData = {
        //     productName: document.querySelector('[name="productName"]').value,
        //     productPrice: document.querySelector('[name="productPrice"]').value,
        //     productDescription: document.querySelector('[name="productDescription"]').value,
        //     productSessionId: document.querySelector('[name="productSessionId"]').value,
        //     productNotes: document.querySelector('[name="productNotes"]').value,
        //     productGender: document.querySelector('[name="productGender"]').value,
        //     productFit: document.querySelector('[name="productFit"]').value,
        //     productTexture: document.querySelector('[name="productTexture"]').value,
        //     productThickness: document.querySelector('[name="productThickness"]').value,
        //     productManufacturer: document.querySelector('[name="productManufacturer"]').value,
        //     productOrigin: document.querySelector('[name="productOrigin"]').value,
        //     productQualityAssuranceStandard: document.querySelector('[name="productQualityAssuranceStandard"]').value,
        //     productDetailColor: document.querySelector('[name="colors"]').value,
        //     productDetailSize: document.querySelector('[name="sizes"]').value,
        // };

        // JSON을 Blob으로 변환 후 FormData에 추가
        // const productBlob = new Blob([JSON.stringify(productData)], { type: "application/json" });
        // formData.append("product", productBlob);

        // 이미지 파일 추가
        const fileInput = document.getElementById("newImg");
        if (fileInput && fileInput.files && fileInput.files.length > 0) {
            formData.append("image", fileInput.files[0]); // 실제 파일을 참조
        } else {
            console.warn("파일이 선택되지 않았습니다.");
        }

        // 데이터 확인
        for (let [key, value] of formData.entries()) {
            console.log(`${key}:`, value);
        }

        // 서버로 요청 보내기
        axios.post("/manager/addNewProduct", formData)
            .then(response => console.log("성공:", response))
            .catch(error => console.error("실패:", error.response?.data || error));
    });



    function addSizeInput(name) {
        // 새로운 input 요소 생성
        const newInput = document.createElement("input");
        newInput.type = "text";
        newInput.name = name; // 같은 name으로 추가 가능
        newInput.style.display = "block"; // 줄바꿈을 위해 block 스타일 적용

        // 부모 요소에 추가
        document.getElementById("sizeContainer").appendChild(newInput);
    }

    function addColorInput(name) {
        // 새로운 input 요소 생성
        const newInput = document.createElement("input");
        newInput.type = "text";
        newInput.name = name; // 같은 name으로 추가 가능
        newInput.style.display = "block"; // 줄바꿈을 위해 block 스타일 적용

        // 부모 요소에 추가
        document.getElementById("colorContainer").appendChild(newInput);
    }
</script>

</body>
</html>
