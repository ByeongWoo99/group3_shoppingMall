<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link rel="stylesheet" th:href="@{/css/Bars.css}">
    <link rel="stylesheet" th:href="@{/css/Login.css}">
    <title th:text="${pageTitle}">Shop Homepage - Start Bootstrap Template</title>
    <!-- Bootstrap icons-->
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap-icons1.5.0/font/bootstrap-icons.css}" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link th:href="@{/css/homecss/homeStyles.css}" rel="stylesheet" />
</head>

<body>


<div style="display: flex; flex-direction: column; margin-bottom: 15px;">
    <h2>고객 민원 관리</h2>
    <div style="margin-bottom: 10px;">
        <button class="btn btn-outline-primary mb-2" onclick="filterComplaints('all')">전체</button>
        <button class="btn btn-outline-secondary mb-2" onclick="filterComplaints('cancel')">취소</button>
        <button class="btn btn-outline-warning mb-2" onclick="filterComplaints('refund')">환불</button>
        <button class="btn btn-outline-info mb-2" onclick="filterComplaints('exchange')">교환</button>
    </div>

    <div style="max-height: 500px; width: 1500px; overflow-y: auto;">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>삭제 활성화 여부</th>
                <th>신청 날짜</th>
                <th>완료 날짜</th>
                <th style="white-space: nowrap;">민원 유형</th>
                <th>상태</th>
                <th>제목</th>
                <th>액션</th>
            </tr>
            </thead>
            <tbody id="complaintTable">
            <tr th:each="complaint : ${complaints}">
                <td th:text="${complaint.deleteFlag == 1 ? '활성화' : '비활성화'}"></td>
                <td th:text="${complaint.requestDatetime}"></td>
                <td th:text="${complaint.endDatetime}"></td>
                <td th:text="${complaint.complaintTypeId == 'cancel' ? '취소' : (complaint.complaintTypeId == 'refund' ? '환불' : (complaint.complaintTypeId == 'exchange' ? '교환' : complaint.complaintTypeId))}"></td>
                <td th:text="${complaint.status}"></td>
                <td th:text="${complaint.reason}"></td>
                <td>
                    <a class="btn btn-primary btn-sm" th:href="@{'/complaint/detail/' + ${complaint.complaintId}}">정보 확인</a>
                    <form th:action="@{'/admin/complaint/receive/' + ${complaint.complaintId}}" method="post" style="display:inline;" onsubmit="return confirmReceive();"
                          th:if="${#strings.contains(complaint.status, '신청')}">
                        <input type="hidden" name="complaintType" th:value="${complaint.complaintTypeId}">
                        <button type="submit" class="btn btn-success btn-sm">접수</button>
                    </form>
                    <a class="btn btn-warning btn-sm" th:href="@{'/admin/complaint/edit/' + ${complaint.complaintId} + '?complaintType=' + ${complaint.complaintTypeId}}"
                       th:if="${#strings.contains(complaint.status, '접수')}">답변</a>
                    <form th:action="@{'/admin/complaint/delete/' + ${complaint.complaintId}}" method="post" style="display:inline;" onsubmit="return confirmDelete();">
                        <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>


<script>
    <!-- 민원 유형별로 민원 출력 -->
    function filterComplaints(type) {
        const rows = document.querySelectorAll('#complaintTable tr');
        rows.forEach(row => {
            const complaintType = row.querySelector('td:nth-child(4)').innerText.trim();
            if (type === 'all' ||
                (type === 'cancel' && complaintType === '취소') ||
                (type === 'refund' && complaintType === '환불') ||
                (type === 'exchange' && complaintType === '교환')) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    function confirmReceive() {
        return confirm("정말로 접수하시겠습니까?");
    }

    function confirmDelete() {
        return confirm("정말로 삭제하시겠습니까?");
    }
</script>

</body>

<footer>
    <div th:replace="Bars/footer :: #footer"></div>
</footer>

</html>
